import flixel.FlxG;
import flixel.FlxSprite;
import funkin.Paths;
import funkin.play.PlayState;
import funkin.audio.FunkinSound;
import funkin.graphics.FunkinSprite;
import funkin.play.notes.notekind.NoteKind;

class StaticNote extends NoteKind
{
    var staticFlash:FunkinSprite;

	public function new(noteKind:String, description:String = "", ?noteStyleId:String, ?params:Array<NoteKindParam>)
	{
		super("staticnote", "Static Note (EXE)", "staticnote", []);

        staticFlash = new FlxSprite(-100, -100);
        staticFlash.frames = Paths.getSparrowAtlas("hitStatic");
        staticFlash.animation.addByPrefix("flash", "staticANIMATION000", 30, false);
        staticFlash.scale.set(1.25, 1.25);
        staticFlash.updateHitbox();
        staticFlash.zIndex = 1002;
		staticFlash.alpha = FlxG.onMobile ? 0.55 : 1;
	}

	function onNoteIncoming(event)
	{
		super.onNoteIncoming(event);

		event.note.lowPriority = true;
		event.note.offset.x = 40.3;
	}

	function onNoteHit(event:HitNoteScriptEvent)
	{
		if (event.judgement == "perfect" || event.judgement == "good")
		{
    		super.onNoteHit(event);
			return;
		}
	}

	function onNoteMiss(event:NoteScriptEvent)
	{
        event.cancelEvent();

        PlayState.instance.health -= 0.3;
		
        staticFlash.cameras = [PlayState.instance.camHUD];
        PlayState.instance.add(staticFlash);
		staticFlash.animation.play("flash");
		staticFlash.animation.finishCallback = function(name:String) {
			PlayState.instance.remove(staticFlash);
		}
        FunkinSound.playOnce(Paths.sound("hitStatic1"));
	}
}